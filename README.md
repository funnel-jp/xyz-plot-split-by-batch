# xyz-plot-split-by-batch

Stable Diffusion WebUI (Automatic1111) の標準スクリプトである「X/Y/Z Plot」を拡張し、バッチサイズ > 1 の生成時にグリッドをバッチ単位で分割して出力できるようにするパッチスクリプトです。

## 概要

通常の X/Y/Z Plot では、メイン設定の `Batch size` を 2 以上に設定しても、グリッド生成時には最初の画像のみが使われるか、1つのセルにまとめられてしまうことが一般的です。

このスクリプトを導入すると、X/Y/Z Plot の設定項目に **「Split grids by batch size」** オプションが追加されます。これを有効にすることで、バッチ内の各画像（1枚目、2枚目...）ごとに独立した比較グリッド画像を生成・保存できるようになります。シード値の変動やControlNet等の挙動をバッチ単位で検証したい場合に便利です。

## 機能

* **Split grids by batch size**: バッチサイズ（Batch size）が 2 以上の場合、バッチのインデックスごと（例：Batch #1用グリッド、Batch #2用グリッド...）にグリッド画像を分けて生成します。
* **Legend for Batch Count**: 分割されたグリッドに「Batch #n」というラベル（レジェンド）を描画するオプションを追加します。

## インストール方法

1.  WebUI の `Extensions` タブを開きます。
2.  `Install from URL` を選択します。
3.  このリポジトリの URL を入力し、`Install` をクリックします。
4.  WebUI を再起動（Reload UI）します。

## 使い方

1.  **txt2img**  タブを開きます。
2.  画面左上の生成設定で **Batch size** を 2 以上に設定します（単一画像生成の場合は通常のXYZ Plotと同じ挙動になります）。
3.  ページ下部の Script ドロップダウンから **X/Y/Z Plot** を選択します。
    * *※このスクリプトが正しく読み込まれていれば、標準のUIの中に新しいチェックボックスが追加されています。*
4.  通常の X/Y/Z Plot の設定（X軸、Y軸の種類など）を行います。
5.  新たに追加されたオプション **「Split grids by batch size」** にチェックを入れます。
6.  必要に応じて **「Legend for Batch Count」** にチェックを入れます（グリッド上にバッチ番号を表示したい場合）。
7.  **Generate** ボタンを押して生成を開始します。

## 注意事項

* このスクリプトは、WebUIのロード完了後に標準の `xyz_grid.py` クラスと関数を動的に書き換える（Monkey Patch）ことで動作しています。そのため、Stable Diffusion WebUI 本体のアップデートにより `xyz_grid.py` の内部構造が大きく変更された場合、正しく動作しなくなる可能性があります。
* 他の「X/Y/Z Plot」を改造・拡張するスクリプトと同時に使用すると競合する可能性があります。
